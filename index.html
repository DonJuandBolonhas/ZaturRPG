<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zatur RPG - Mestre</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap');
  :root {
    --color-primary: #6b4c2a;
    --color-primary-dark: #4b2e0e;
    --color-primary-light: #8c6b3a;
    --color-secondary: #3a220a;
    --color-accent: #a07c3f;
    --color-text: #f5f1e9;
    --color-background: #3a220a;
    --color-success: #4a7a4a;
    --color-danger: #a03a3a;
    --color-warning: #9a7a5a;
    --color-info: #3a5a8a;
    --border-radius: 8px;
    --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    --transition: all 0.3s ease;
  }
  
  * {
    box-sizing: border-box;
  }
  
  body {
    margin: 0; 
    font-family: 'MedievalSharp', cursive, serif;
    background: linear-gradient(135deg, var(--color-secondary) 25%, var(--color-primary-dark) 75%);
    color: var(--color-text);
    min-height: 100vh; 
    display: flex; 
    flex-direction: column;
    line-height: 1.6;
  }
  
  /* Header Styles */
  header {
    background: var(--color-primary-dark); 
    padding: 1rem 1.5rem;
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  
  header h1 { 
    margin: 0; 
    font-size: 1.5rem; 
  }
  
  header button {
    background: var(--color-primary); 
    border: none; 
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius); 
    color: var(--color-text); 
    font-weight: bold;
    cursor: pointer; 
    transition: var(--transition);
  }
  
  header button:hover { 
    background: var(--color-primary-light); 
  }

  /* Navigation Tabs */
  nav.tabs {
    display: flex; 
    flex-wrap: wrap; 
    background: var(--color-secondary);
    box-shadow: inset 0 -3px 5px var(--color-primary);
    position: sticky;
    top: 68px;
    z-index: 90;
  }
  
  nav.tabs button {
    flex: 1 1 auto;
    background: none; 
    border: none; 
    color: var(--color-text);
    padding: 1rem; 
    font-weight: bold; 
    font-size: 1rem;
    cursor: pointer; 
    transition: var(--transition);
    min-width: 120px;
  }
  
  nav.tabs button.active,
  nav.tabs button:hover {
    background: var(--color-primary); 
    color: #fff;
    box-shadow: 0 0 10px var(--color-primary-light);
  }

  /* Main Content */
  main.container {
    flex: 1; 
    max-width: 1200px; 
    margin: 1rem auto 2rem;
    background: rgba(30,20,10,0.9); 
    border-radius: 10px;
    padding: 1.5rem; 
    box-shadow: var(--shadow);
  }

  section.tab-content { 
    display: none; 
  }
  
  section.tab-content.active { 
    display: block; 
  }

  /* Form Styles */
  form {
    margin-bottom: 1.5rem;
    background: rgba(75, 46, 14, 0.3);
    padding: 1rem;
    border-radius: var(--border-radius);
  }
  
  .field-pair {
    display: flex; 
    gap: 0.5rem; 
    margin-bottom: 0.5rem;
    flex-wrap: wrap;
  }
  
  .field-pair input,
  .field-pair select,
  .field-pair textarea {
    flex: 1; 
    padding: 0.6rem 0.8rem; 
    border-radius: var(--border-radius);
    border: 2px solid var(--color-primary); 
    font-family: 'MedievalSharp', cursive;
    font-size: 1rem;
    background-color: rgba(255,248,231,0.85);
    min-width: 150px;
  }
  
  .field-pair input.name-field {
    max-width: 200px;
  }
  
  .add-field-btn {
    background: var(--color-accent); 
    border: none; 
    color: var(--color-text);
    padding: 0.5rem 1rem; 
    border-radius: var(--border-radius);
    cursor: pointer; 
    font-weight: bold; 
    margin-bottom: 1rem;
    transition: var(--transition);
  }
  
  .add-field-btn:hover {
    background: var(--color-primary-light);
  }
  
  .submit-btn {
    background: var(--color-primary); 
    border: none; 
    color: var(--color-text);
    padding: 0.8rem 1.2rem; 
    border-radius: var(--border-radius);
    cursor: pointer; 
    font-weight: bold; 
    width: 100%;
    font-size: 1.1rem;
    transition: var(--transition);
  }
  
  .submit-btn:hover {
    background: var(--color-primary-light);
  }

  /* List Items */
  .list-items {
    list-style: none; 
    padding-left: 0; 
    max-height: 400px; 
    overflow-y: auto;
    border-top: 1px solid var(--color-primary); 
    margin-top: 0.5rem;
    display: grid;
    gap: 0.5rem;
  }
  
  .list-items li {
    background: var(--color-primary-dark); 
    padding: 0.8rem 1rem;
    border-radius: var(--border-radius); 
    display: flex; 
    justify-content: space-between;
    align-items: center; 
    font-size: 1rem;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .list-items li .character-info {
    flex: 1;
    min-width: 200px;
  }
  
  .list-items li .character-actions {
    display: flex;
    gap: 0.3rem;
    flex-wrap: wrap;
  }
  
  /* Button Styles */
  .btn {
    border: none; 
    border-radius: var(--border-radius); 
    padding: 0.4rem 0.8rem; 
    cursor: pointer;
    font-weight: bold; 
    font-size: 0.9rem;
    transition: var(--transition);
    color: var(--color-text);
  }
  
  .btn-sm {
    padding: 0.3rem 0.6rem;
    font-size: 0.8rem;
  }
  
  .del-btn {
    background: var(--color-danger);
  }
  
  .del-btn:hover {
    background: #c04a4a;
  }
  
  .edit-btn {
    background: var(--color-success);
  }
  
  .edit-btn:hover {
    background: #5fa75f;
  }
  
  .view-btn {
    background: var(--color-info);
  }
  
  .view-btn:hover {
    background: #4a6a9a;
  }
  
  .assign-btn {
    background: var(--color-primary);
  }
  
  .assign-btn:hover {
    background: var(--color-primary-light);
  }
  
  .btn-group {
    display: flex;
    gap: 0.3rem;
    flex-wrap: wrap;
  }

  /* Dice Roller */
  .dice-buttons {
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 0.5rem; 
    margin-top: 1rem;
  }
  
  .dice-buttons button {
    background: var(--color-primary); 
    border: none; 
    color: var(--color-text);
    padding: 0.8rem; 
    border-radius: var(--border-radius);
    font-weight: bold; 
    font-size: 1.1rem; 
    cursor: pointer;
    transition: var(--transition);
  }
  
  .dice-buttons button:hover {
    background: var(--color-primary-light);
  }
  
  #dice-result {
    margin-top: 1.5rem; 
    font-size: 1.3rem; 
    font-weight: bold;
    text-align: center; 
    padding: 1.2rem;
    background: var(--color-primary-dark); 
    border-radius: 10px;
    box-shadow: inset 0 0 10px var(--color-primary-light);
  }

  /* Modal Styles */
  .modal {
    display: none; 
    position: fixed; 
    z-index: 1000;
    left: 0; 
    top: 0; 
    width: 100%; 
    height: 100%;
    background-color: rgba(0,0,0,0.7);
    overflow: auto;
    padding: 1rem;
  }
  
  .modal-content {
    background: var(--color-secondary); 
    margin: 2rem auto; 
    padding: 1.5rem;
    border: 1px solid var(--color-primary); 
    width: 100%; 
    max-width: 800px;
    border-radius: 10px; 
    box-shadow: 0 0 20px var(--color-primary-light);
    position: relative;
  }
  
  .close-modal {
    color: #aaa; 
    position: absolute;
    top: 1rem;
    right: 1.5rem;
    font-size: 28px;
    font-weight: bold; 
    cursor: pointer;
  }
  
  .close-modal:hover {
    color: #fff;
  }
  
  .assign-grid {
    display: grid; 
    grid-template-columns: 1fr 1fr;
    gap: 1rem; 
    margin: 1rem 0;
  }
  
  .assign-item {
    background: var(--color-primary-dark); 
    padding: 0.8rem; 
    border-radius: var(--border-radius);
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    margin-bottom: 0.5rem;
  }
  
  .assign-item label {
    margin-left: 0.5rem;
    flex: 1;
    cursor: pointer;
  }

  /* Character Cards for Better Organization */
  .character-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
    margin-top: 1.5rem;
  }
  
  .character-card {
    background: var(--color-primary-dark);
    border-radius: var(--border-radius);
    padding: 1rem;
    box-shadow: var(--shadow);
  }
  
  .character-card h3 {
    margin-top: 0;
    color: var(--color-accent);
    border-bottom: 1px solid var(--color-primary);
    padding-bottom: 0.5rem;
  }
  
  .character-card .card-content {
    margin-bottom: 1rem;
  }
  
  .character-card .card-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  /* Filter and Search */
  .filter-container {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    align-items: center;
  }
  
  .search-box {
    flex: 1;
    min-width: 250px;
    position: relative;
  }
  
  .search-box input {
    width: 100%;
    padding: 0.6rem 1rem 0.6rem 2.5rem;
    border-radius: var(--border-radius);
    border: 2px solid var(--color-primary);
    background-color: rgba(255,248,231,0.85);
  }
  
  .search-box::before {
    content: "üîç";
    position: absolute;
    left: 0.8rem;
    top: 0.5rem;
    font-size: 1.2rem;
  }
  
  .filter-select {
    padding: 0.6rem 1rem;
    border-radius: var(--border-radius);
    border: 2px solid var(--color-primary);
    background-color: rgba(255,248,231,0.85);
    min-width: 150px;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    header {
      flex-direction: column;
      gap: 0.5rem;
      padding: 0.8rem;
    }
    
    nav.tabs {
      top: 112px;
    }
    
    nav.tabs button {
      min-width: 100px;
      padding: 0.8rem 0.5rem;
      font-size: 0.9rem;
    }
    
    .field-pair {
      flex-direction: column;
    }
    
    .field-pair input.name-field {
      max-width: 100%;
    }
    
    .assign-grid {
      grid-template-columns: 1fr;
    }
    
    .modal-content {
      margin: 1rem auto;
      padding: 1rem;
    }
    
    .list-items li {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .list-items li .character-actions {
      width: 100%;
      justify-content: center;
    }
    
    .character-cards {
      grid-template-columns: 1fr;
    }
    
    .filter-container {
      flex-direction: column;
      align-items: stretch;
    }
    
    .search-box {
      min-width: 100%;
    }
  }

  @media (max-width: 480px) {
    nav.tabs button {
      flex: 1 1 50%;
      min-width: 80px;
      font-size: 0.8rem;
      padding: 0.6rem 0.3rem;
    }
    
    main.container {
      padding: 1rem;
      margin: 0.5rem;
    }
    
    .btn-group {
      flex-direction: column;
      width: 100%;
    }
    
    .btn-group .btn {
      width: 100%;
      text-align: center;
    }
  }

  /* Scrollbar Styling */
  ::-webkit-scrollbar {
    width: 10px;
  }
  
  ::-webkit-scrollbar-thumb {
    background: var(--color-primary); 
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-track {
    background: var(--color-secondary);
  }
</style>
</head>
<body>

<header>
  <h1>Zatur RPG - Mestre</h1>
  <button id="logout-btn" title="Sair">Sair</button>
</header>

<nav class="tabs" role="tablist" aria-label="Se√ß√µes do painel">
  <button class="tab-btn active" data-tab="campaigns" role="tab" aria-selected="true" aria-controls="campaigns" id="tab-campaigns">Campanhas</button>
  <button class="tab-btn" data-tab="characters" role="tab" aria-selected="false" aria-controls="characters" id="tab-characters">Personagens</button>
  <button class="tab-btn" data-tab="monsters" role="tab" aria-selected="false" aria-controls="monsters" id="tab-monsters">Monstros</button>
  <button class="tab-btn" data-tab="items" role="tab" aria-selected="false" aria-controls="items" id="tab-items">Itens</button>
  <button class="tab-btn" data-tab="spells" role="tab" aria-selected="false" aria-controls="spells" id="tab-spells">Feiti√ßos</button>
  <button class="tab-btn" data-tab="skills" role="tab" aria-selected="false" aria-controls="skills" id="tab-skills">Per√≠cias</button>
  <button class="tab-btn" data-tab="dice" role="tab" aria-selected="false" aria-controls="dice" id="tab-dice">Rolagem de Dados</button>
</nav>

<main class="container" role="main">

  <!-- Campanhas -->
  <section id="campaigns" class="tab-content active" role="tabpanel" aria-labelledby="tab-campaigns">
    <h2>Campanhas</h2>
    <form id="form-campaign">
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Nome" readonly />
        <input type="text" name="field-value" placeholder="Nome da campanha" required />
      </div>
      <button type="button" class="add-field-btn" data-form="form-campaign">+ Adicionar campo</button>
      <button type="submit" class="submit-btn">Criar Campanha</button>
    </form>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="campaign-search" placeholder="Buscar campanhas..." />
      </div>
    </div>
    
    <ul id="list-campaigns" class="list-items" aria-live="polite" aria-relevant="additions removals"></ul>
  </section>

  <!-- Personagens -->
  <section id="characters" class="tab-content" role="tabpanel" aria-labelledby="tab-characters">
    <h2>Personagens</h2>
    <form id="form-character">
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Nome" readonly />
        <input type="text" id="character-name" name="field-value" placeholder="Nome do personagem" required />
      </div>
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Campanha" readonly />
        <select name="field-value" id="character-campaign">
          <option value="">Nenhuma campanha</option>
        </select>
      </div>
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Origem" readonly />
        <input type="text" name="field-value" placeholder="Origem (opcional)" />
      </div>
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Classe" readonly />
        <input type="text" name="field-value" placeholder="Classe (opcional)" />
      </div>
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Cl√£" readonly />
        <input type="text" name="field-value" placeholder="Cl√£ (opcional)" />
      </div>
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="N√≠vel" readonly />
        <input type="number" name="field-value" placeholder="N√≠vel (opcional)" min="1" />
      </div>
	<div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="For√ßa" readonly />
        <input type="number" name="field-value" placeholder="For√ßa (opcional)" min="1" />
      </div>
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Agilidade" readonly />
        <input type="number" name="field-value" placeholder="Agilidade (opcional)" min="1" />
      </div>
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Mana" readonly />
        <input type="number" name="field-value" placeholder="Mana (opcional)" min="1" />
      </div>
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Intelecto" readonly />
        <input type="number" name="field-value" placeholder="Intelecto (opcional)" min="1" />
      </div>
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Vigor" readonly />
        <input type="number" name="field-value" placeholder="Vigor (opcional)" min="1" />
      </div>
      <button type="button" class="add-field-btn" data-form="form-character">+ Adicionar campo</button>
      <button type="submit" class="submit-btn">Criar Personagem</button>
    </form>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="character-search" placeholder="Buscar personagens..." />
      </div>
      <select id="character-campaign-filter" class="filter-select">
        <option value="">Todas as campanhas</option>
      </select>
    </div>
    
    <div id="character-cards" class="character-cards"></div>
    <ul id="list-characters" class="list-items" aria-live="polite" aria-relevant="additions removals"></ul>
  </section>

  <!-- Monstros -->
  <section id="monsters" class="tab-content" role="tabpanel" aria-labelledby="tab-monsters">
    <h2>Monstros</h2>
    <form id="form-monster">
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Nome" readonly />
        <input type="text" name="field-value" placeholder="Nome do monstro" required />
      </div>
      <button type="button" class="add-field-btn" data-form="form-monster">+ Adicionar campo</button>
      <button type="submit" class="submit-btn">Criar Monstro</button>
    </form>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="monster-search" placeholder="Buscar monstros..." />
      </div>
    </div>
    
    <ul id="list-monsters" class="list-items" aria-live="polite" aria-relevant="additions removals"></ul>
  </section>

  <!-- Itens -->
  <section id="items" class="tab-content" role="tabpanel" aria-labelledby="tab-items">
    <h2>Itens</h2>
    <form id="form-item">
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Nome" readonly />
        <input type="text" name="field-value" placeholder="Nome do item" required />
      </div>
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Tipo" readonly />
        <select name="field-value">
          <option value="item">Item Comum</option>
          <option value="tool">Ferramenta</option>
          <option value="magic">Habilidade M√°gica</option>
        </select>
      </div>
      <button type="button" class="add-field-btn" data-form="form-item">+ Adicionar campo</button>
      <button type="submit" class="submit-btn">Criar Item</button>
    </form>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="item-search" placeholder="Buscar itens..." />
      </div>
      <select id="item-type-filter" class="filter-select">
        <option value="">Todos os tipos</option>
        <option value="item">Itens Comuns</option>
        <option value="tool">Ferramentas</option>
        <option value="magic">Habilidades M√°gicas</option>
      </select>
    </div>
    
    <ul id="list-items" class="list-items" aria-live="polite" aria-relevant="additions removals"></ul>
  </section>

  <!-- Feiti√ßos -->
  <section id="spells" class="tab-content" role="tabpanel" aria-labelledby="tab-spells">
    <h2>Feiti√ßos</h2>
    <form id="form-spell">
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Nome" readonly />
        <input type="text" name="field-value" placeholder="Nome do feiti√ßo" required />
      </div>
      <button type="button" class="add-field-btn" data-form="form-spell">+ Adicionar campo</button>
      <button type="submit" class="submit-btn">Criar Feiti√ßo</button>
    </form>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="spell-search" placeholder="Buscar feiti√ßos..." />
      </div>
    </div>
    
    <ul id="list-spells" class="list-items" aria-live="polite" aria-relevant="additions removals"></ul>
  </section>

  <!-- Per√≠cias -->
  <section id="skills" class="tab-content" role="tabpanel" aria-labelledby="tab-skills">
    <h2>Per√≠cias</h2>
    <button type="button" class="add-field-btn" id="create-skill-btn">+ Criar Per√≠cia</button>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="skill-search" placeholder="Buscar per√≠cias..." />
      </div>
    </div>
    
    <ul id="list-skills" class="list-items" aria-live="polite" aria-relevant="additions removals"></ul>
  </section>

  <!-- Rolagem de Dados -->
  <section id="dice" class="tab-content" role="tabpanel" aria-labelledby="tab-dice">
    <h2>Rolagem de Dados</h2>
    <div class="dice-buttons" role="group" aria-label="Bot√µes para rolar dados">
      <button data-dice="4" aria-label="Rolar D4">D4</button>
      <button data-dice="6" aria-label="Rolar D6">D6</button>
      <button data-dice="8" aria-label="Rolar D8">D8</button>
      <button data-dice="10" aria-label="Rolar D10">D10</button>
      <button data-dice="12" aria-label="Rolar D12">D12</button>
      <button data-dice="20" aria-label="Rolar D20">D20</button>
      <button data-dice="100" aria-label="Rolar D100">D100</button>
    </div>
    
    <div class="field-pair" style="margin-top: 1.5rem;">
      <input type="text" class="name-field" value="Quantidade" readonly />
      <input type="number" id="dice-quantity" value="1" min="1" max="10" />
    </div>
    
    <div class="field-pair">
      <input type="text" class="name-field" value="Modificador" readonly />
      <input type="number" id="dice-modifier" value="0" />
    </div>
    
    <button id="roll-custom-dice" class="submit-btn">Rolar Dados Personalizados</button>
    
    <div id="dice-result" aria-live="polite" aria-atomic="true"></div>
    
    <div id="dice-history" style="margin-top: 1.5rem;"></div>
  </section>

</main>

<!-- Modal para atribui√ß√£o de itens/feiti√ßos -->
<div id="assign-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2 id="modal-title">Atribuir a <span id="character-name-modal"></span></h2>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="assign-search" placeholder="Buscar itens/feiti√ßos..." />
      </div>
    </div>
    
    <div class="assign-grid">
      <div>
        <h3>Itens Dispon√≠veis</h3>
        <div id="available-items"></div>
      </div>
      <div>
        <h3>Feiti√ßos Dispon√≠veis</h3>
        <div id="available-spells"></div>
      </div>
    </div>
    <button id="confirm-assign" class="submit-btn">Confirmar Atribui√ß√£o</button>
  </div>
</div>

<!-- Modal para atribui√ß√£o de ferramentas -->
<div id="assign-tools-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2>Atribuir Ferramentas a <span id="character-name-tools-modal"></span></h2>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="tools-search" placeholder="Buscar ferramentas..." />
      </div>
    </div>
    
    <div id="available-tools"></div>
    <button id="confirm-tools-assign" class="submit-btn">Confirmar Atribui√ß√£o</button>
  </div>
</div>

<!-- Modal para atribui√ß√£o de habilidades m√°gicas -->
<div id="assign-magic-abilities-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2>Atribuir Habilidades M√°gicas a <span id="character-name-magic-modal"></span></h2>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="magic-search" placeholder="Buscar habilidades..." />
      </div>
    </div>
    
    <div id="available-magic-abilities"></div>
    <button id="confirm-magic-assign" class="submit-btn">Confirmar Atribui√ß√£o</button>
  </div>
</div>

<!-- Modal para atribui√ß√£o de per√≠cias -->
<div id="assign-skills-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2>Atribuir Per√≠cias a <span id="character-name-skills-modal"></span></h2>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="skills-assign-search" placeholder="Buscar per√≠cias..." />
      </div>
    </div>
    
    <div id="available-skills"></div>
    <button id="confirm-skills-assign" class="submit-btn">Confirmar Atribui√ß√£o</button>
  </div>
</div>

<!-- Modal para cria√ß√£o de per√≠cias -->
<div id="create-skill-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2>Criar Nova Per√≠cia</h2>
    <form id="create-skill-form">
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Nome" readonly />
        <input type="text" name="field-value" placeholder="Nome da per√≠cia" required />
      </div>
      <div class="field-pair">
        <input type="text" name="field-name" class="name-field" placeholder="Nome do campo" value="Descri√ß√£o" readonly />
        <textarea name="field-value" placeholder="Descri√ß√£o da per√≠cia" required></textarea>
      </div>
      <button type="submit" class="submit-btn">Criar Per√≠cia</button>
    </form>
  </div>
</div>

<!-- Modal para desatribuir itens/feiti√ßos -->
<div id="unassign-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2>Desatribuir de <span id="character-name-unassign-modal"></span></h2>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="unassign-search" placeholder="Buscar itens/feiti√ßos..." />
      </div>
    </div>
    
    <div class="assign-grid">
      <div>
        <h3>Itens Atribu√≠dos</h3>
        <div id="assigned-items"></div>
      </div>
      <div>
        <h3>Feiti√ßos Atribu√≠dos</h3>
        <div id="assigned-spells"></div>
      </div>
    </div>
    <button id="confirm-unassign" class="submit-btn">Confirmar Desatribui√ß√£o</button>
  </div>
</div>

<!-- Modal para desatribuir ferramentas -->
<div id="unassign-tools-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2>Desatribuir Ferramentas de <span id="character-name-unassign-tools-modal"></span></h2>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="tools-unassign-search" placeholder="Buscar ferramentas..." />
      </div>
    </div>
    
    <div id="assigned-tools"></div>
    <button id="confirm-unassign-tools" class="submit-btn">Confirmar Desatribui√ß√£o</button>
  </div>
</div>

<!-- Modal para desatribuir habilidades m√°gicas -->
<div id="unassign-magic-abilities-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2>Desatribuir Habilidades M√°gicas de <span id="character-name-unassign-magic-modal"></span></h2>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="magic-unassign-search" placeholder="Buscar habilidades..." />
      </div>
    </div>
    
    <div id="assigned-magic-abilities"></div>
    <button id="confirm-unassign-magic" class="submit-btn">Confirmar Desatribui√ß√£o</button>
  </div>
</div>

<!-- Modal para desatribuir per√≠cias -->
<div id="unassign-skills-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2>Desatribuir Per√≠cias de <span id="character-name-unassign-skills-modal"></span></h2>
    
    <div class="filter-container">
      <div class="search-box">
        <input type="text" id="skills-unassign-search" placeholder="Buscar per√≠cias..." />
      </div>
    </div>
    
    <div id="assigned-skills"></div>
    <button id="confirm-unassign-skills" class="submit-btn">Confirmar Desatribui√ß√£o</button>
  </div>
</div>

<!-- Modal para edi√ß√£o de personagem -->
<div id="edit-character-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2>Editar Personagem: <span id="edit-character-name"></span></h2>
    <form id="edit-character-form">
      <!-- Os campos ser√£o adicionados dinamicamente via JavaScript -->
    </form>
    <button id="confirm-edit" class="submit-btn">Salvar Altera√ß√µes</button>
  </div>
</div>

<!-- Modal para visualiza√ß√£o r√°pida -->
<div id="quick-view-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2 id="quick-view-title">Detalhes</h2>
    <div id="quick-view-content"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getAuth, 
  onAuthStateChanged, 
  signOut,
  signInWithEmailAndPassword 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { 
  getFirestore, 
  collection, 
  addDoc, 
  doc, 
  setDoc,
  onSnapshot, 
  deleteDoc, 
  getDocs, 
  updateDoc,
  arrayUnion,
  arrayRemove,
  query,
  where,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Configura√ß√£o do Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAgYVod9B99WIc_QysFx73htOf9O8XtuE8",
  authDomain: "zatur-rpg.firebaseapp.com",
  projectId: "zatur-rpg",
  storageBucket: "zatur-rpg.firebasestorage.app",
  messagingSenderId: "797058283992",
  appId: "1:797058283992:web:7132e71691a225c1255aad"
};

// Inicializar Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Vari√°veis globais para controle de estado
let currentUser = null;
let currentCharacterId = null;
let selectedItems = [];
let selectedSpells = [];
let selectedTools = [];
let selectedMagicAbilities = [];
let selectedSkills = [];
let currentEditCharacterId = null;
let itemsToRemove = [];
let spellsToRemove = [];
let toolsToRemove = [];
let magicAbilitiesToRemove = [];
let skillsToRemove = [];

// Elementos DOM
const modals = document.querySelectorAll('.modal');
const closeModalBtns = document.querySelectorAll('.close-modal');
const tabButtons = document.querySelectorAll('.tab-btn');
const tabContents = document.querySelectorAll('.tab-content');
const addFieldButtons = document.querySelectorAll('.add-field-btn');
const diceButtons = document.querySelectorAll('.dice-buttons button');
const diceResult = document.getElementById('dice-result');
const logoutBtn = document.getElementById('logout-btn');

// Inicializa√ß√£o
document.addEventListener('DOMContentLoaded', () => {
  initAuth();
  initEventListeners();
  initTabs();
});

// Sistema de Autentica√ß√£o
function initAuth() {
  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      console.log("Usu√°rio autenticado:", user.email);
      loadAllData();
    } else {
      showLoginPrompt();
    }
  });
}

function showLoginPrompt() {
  const email = prompt("Email do mestre:");
  const password = prompt("Senha:");
  
  if (email && password) {
    signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        currentUser = userCredential.user;
      })
      .catch((error) => {
        alert("Erro no login: " + error.message);
        showLoginPrompt();
      });
  }
}

// Configura√ß√£o de Event Listeners
function initEventListeners() {
  // Logout
  logoutBtn.addEventListener('click', () => {
    signOut(auth).then(() => {
      alert("Deslogado com sucesso!");
      showLoginPrompt();
    });
  });

  // Fechar modais
  closeModalBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const modal = btn.closest('.modal');
      modal.style.display = 'none';
    });
  });

  // Fechar modal ao clicar fora
  window.addEventListener('click', (e) => {
    modals.forEach(modal => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });
  });

  // Adicionar campos din√¢micos aos formul√°rios
  addFieldButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const formId = btn.dataset.form;
      addDynamicField(formId);
    });
  });

  // Rolagem de dados
  diceButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const sides = parseInt(btn.dataset.dice);
      rollDice(sides);
    });
  });

  // Rolagem de dados personalizada
  document.getElementById('roll-custom-dice')?.addEventListener('click', () => {
    const quantity = parseInt(document.getElementById('dice-quantity').value) || 1;
    const modifier = parseInt(document.getElementById('dice-modifier').value) || 0;
    const sides = 20; // Valor padr√£o para dados personalizados
    
    if (quantity > 0) {
      rollCustomDice(quantity, sides, modifier);
    }
  });

  // Submiss√£o de formul√°rios
  setupFormSubmissions();
}

// Sistema de Abas
function initTabs() {
  tabButtons.forEach(button => {
    button.addEventListener('click', () => {
      const targetTab = button.dataset.tab;
      
      // Atualizar bot√µes
      tabButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
      
      // Atualizar conte√∫do
      tabContents.forEach(content => content.classList.remove('active'));
      document.getElementById(targetTab).classList.add('active');
    });
  });
}

// Adicionar campos din√¢micos aos formul√°rios
function addDynamicField(formId) {
  const form = document.getElementById(formId);
  const fieldPair = document.createElement('div');
  fieldPair.className = 'field-pair';
  
  fieldPair.innerHTML = `
    <input type="text" name="field-name" class="name-field" placeholder="Nome do campo">
    <input type="text" name="field-value" placeholder="Valor do campo">
  `;
  
  const addButton = form.querySelector('.add-field-btn');
  form.insertBefore(fieldPair, addButton);
}

// Rolagem de dados
function rollDice(sides) {
  const result = Math.floor(Math.random() * sides) + 1;
  diceResult.textContent = `Resultado: ${result} (d${sides})`;
  addToDiceHistory(`d${sides}`, result, `Rolagem de d${sides}: ${result}`);
}

// Rolagem de dados personalizada
function rollCustomDice(quantity, sides, modifier) {
  let total = 0;
  let rolls = [];
  
  for (let i = 0; i < quantity; i++) {
    const roll = Math.floor(Math.random() * sides) + 1;
    rolls.push(roll);
    total += roll;
  }
  
  total += modifier;
  
  let resultText = `Rolagens: ${rolls.join(', ')}`;
  if (modifier !== 0) {
    const modifierSign = modifier >= 0 ? '+' : '-';
    resultText += ` ${modifierSign} ${Math.abs(modifier)} = ${total}`;
  } else {
    resultText += ` = ${total}`;
  }
  
  diceResult.textContent = resultText;
  addToDiceHistory(`${quantity}d${sides}${modifier >= 0 ? '+' + modifier : modifier}`, total, resultText);
}

// Adicionar ao hist√≥rico de rolagens
function addToDiceHistory(dice, result, details) {
  const historyElement = document.getElementById('dice-history');
  if (!historyElement) return;
  
  const historyItem = document.createElement('div');
  historyItem.className = 'dice-history-item';
  historyItem.innerHTML = `
    <strong>${dice}</strong>: ${result} 
    <small>(${new Date().toLocaleTimeString()})</small>
    <div>${details}</div>
  `;
  
  historyItem.style.marginBottom = '0.5rem';
  historyItem.style.padding = '0.5rem';
  historyItem.style.background = 'rgba(107, 76, 42, 0.3)';
  historyItem.style.borderRadius = '4px';
  
  // Manter apenas as √∫ltimas 5 rolagens no hist√≥rico
  if (historyElement.children.length >= 5) {
    historyElement.removeChild(historyElement.lastChild);
  }
  
  historyElement.insertBefore(historyItem, historyElement.firstChild);
}

// Configurar submiss√£o de formul√°rios
function setupFormSubmissions() {
  // Formul√°rio de campanhas
  document.getElementById('form-campaign').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = getFormData('form-campaign');
    if (!data.Nome) {
      alert('O campo "Nome" √© obrigat√≥rio para criar uma campanha');
      return;
    }
    await createDocument('campaigns', data);
    e.target.reset();
  });

  // Formul√°rio de personagens
  document.getElementById('form-character').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = getFormData('form-character');
    if (!data.Nome) {
      alert('O campo "Nome" √© obrigat√≥rio para criar um personagem');
      return;
    }
    
    // Adicionar campos calculados
    if (data.Vigor) data.PV = 100 * parseInt(data.Vigor);
    if (data.Mana) data.PE = 20 * parseInt(data.Mana);
    if (data.Agilidade && data.For√ßa) data.Defesa = 20 * parseInt(data.Agilidade) * parseInt(data.For√ßa);
    if (data.Agilidade) data.Deslocamento = 30 * parseInt(data.Agilidade);
    
    // Arrays vazios para itens e habilidades
    data.itens = [];
    data.feiticos = [];
    data.ferramentas = [];
    data.habilidades_magicas = [];
    data.pericias = [];
    
    await createDocument('characters', data);
    e.target.reset();
  });

  // Formul√°rio de monstros
  document.getElementById('form-monster').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = getFormData('form-monster');
    if (!data.Nome) {
      alert('O campo "Nome" √© obrigat√≥rio para criar um monstro');
      return;
    }
    await createDocument('monsters', data);
    e.target.reset();
  });

  // Formul√°rio de itens
  document.getElementById('form-item').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = getFormData('form-item');
    if (!data.Nome) {
      alert('O campo "Nome" √© obrigat√≥rio para criar um item');
      return;
    }
    await createDocument('items', data);
    e.target.reset();
  });

  // Formul√°rio de feiti√ßos
  document.getElementById('form-spell').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = getFormData('form-spell');
    if (!data.Nome) {
      alert('O campo "Nome" √© obrigat√≥rio para criar um feiti√ßo');
      return;
    }
    await createDocument('spells', data);
    e.target.reset();
  });

  // Formul√°rio de per√≠cias
  document.getElementById('create-skill-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = getFormData('create-skill-form');
    if (!data.Nome || !data.Descri√ß√£o) {
      alert('Os campos "Nome" e "Descri√ß√£o" s√£o obrigat√≥rios para criar uma per√≠cia');
      return;
    }
    await createDocument('skills', data);
    e.target.reset();
    document.getElementById('create-skill-modal').style.display = 'none';
  });
}

// Obter dados do formul√°rio
function getFormData(formId) {
  const form = document.getElementById(formId);
  const data = {};
  const nameInputs = form.querySelectorAll('input[name="field-name"], textarea[name="field-name"]');
  const valueInputs = form.querySelectorAll('input[name="field-value"], select[name="field-value"], textarea[name="field-value"]');
  
  for (let i = 0; i < nameInputs.length; i++) {
    const key = nameInputs[i].value.trim();
    const value = valueInputs[i].value.trim();
    
    if (key && value) {
      data[key] = value;
    }
  }
  
  return data;
}

// Opera√ß√µes CRUD com Firebase
async function createDocument(collectionName, data) {
  try {
    const docRef = await addDoc(collection(db, collectionName), data);
    console.log("Documento criado com ID: ", docRef.id);
    return docRef.id;
  } catch (e) {
    console.error("Erro ao adicionar documento: ", e);
    alert("Erro ao criar documento: " + e.message);
  }
}

async function updateDocument(collectionName, id, data) {
  try {
    await updateDoc(doc(db, collectionName, id), data);
    console.log("Documento atualizado com ID: ", id);
  } catch (e) {
    console.error("Erro ao atualizar documento: ", e);
    alert("Erro ao atualizar documento: " + e.message);
  }
}

async function deleteDocument(collectionName, id) {
  try {
    await deleteDoc(doc(db, collectionName, id));
    console.log("Documento exclu√≠do com ID: ", id);
  } catch (e) {
    console.error("Erro ao excluir documento: ", e);
    alert("Erro ao excluir documento: " + e.message);
  }
}

// Carregar todos os dados do Firebase
function loadAllData() {
  loadCollection('campaigns', 'list-campaigns', renderCampaignItem);
  loadCollection('characters', 'list-characters', renderCharacterItem);
  loadCollection('monsters', 'list-monsters', renderMonsterItem);
  loadCollection('items', 'list-items', renderItemItem);
  loadCollection('spells', 'list-spells', renderSpellItem);
  loadCollection('skills', 'list-skills', renderSkillItem);
  
  // Atualizar selects de campanhas
  updateCampaignSelects();
}

// Carregar cole√ß√£o do Firebase
function loadCollection(collectionName, listId, renderFunction) {
  const listElement = document.getElementById(listId);
  if (!listElement) return;
  
  onSnapshot(collection(db, collectionName), (snapshot) => {
    listElement.innerHTML = '';
    
    snapshot.forEach((doc) => {
      const item = renderFunction(doc.id, doc.data());
      listElement.appendChild(item);
    });
    
    // Para personagens, tamb√©m atualizar a visualiza√ß√£o em cards
    if (collectionName === 'characters') {
      updateCharacterCards(snapshot);
    }
  });
}

// Renderizar itens das cole√ß√µes
function renderCampaignItem(id, data) {
  const li = document.createElement('li');
  li.innerHTML = `
    <span>${data.Nome || id}</span>
    <div class="btn-group">
      <button class="btn edit-btn btn-sm">Editar</button>
      <button class="btn del-btn btn-sm">Excluir</button>
    </div>
  `;
  
  li.querySelector('.del-btn').addEventListener('click', () => {
    if (confirm(`Excluir a campanha "${data.Nome || id}"?`)) {
      deleteDocument('campaigns', id);
    }
  });
  
  return li;
}

function renderCharacterItem(id, data) {
  const li = document.createElement('li');
  li.innerHTML = `
    <div class="character-info">
      <strong>${data.Nome || id}</strong>
      <div>N√≠vel: ${data.N√≠vel || '1'}, Classe: ${data.Classe || 'Nenhuma'}</div>
      <div>Campanha: ${data.Campanha || 'Nenhuma'}</div>
    </div>
    <div class="character-actions">
      <button class="btn view-btn btn-sm">Ver Ficha</button>
      <button class="btn assign-btn btn-sm">Atribuir</button>
      <button class="btn edit-btn btn-sm">Editar</button>
      <button class="btn del-btn btn-sm">Excluir</button>
    </div>
  `;
  
  // Adicionar event listeners
  li.querySelector('.del-btn').addEventListener('click', () => {
    if (confirm(`Excluir o personagem "${data.Nome || id}"?`)) {
      deleteDocument('characters', id);
    }
  });
  
  li.querySelector('.assign-btn').addEventListener('click', () => {
    openAssignModal(id, data.Nome || id);
  });
  
  li.querySelector('.view-btn').addEventListener('click', () => {
    window.open(`ficha_personagem.html?id=${id}`, '_blank');
  });
  
  li.querySelector('.edit-btn').addEventListener('click', () => {
    openEditModal(id, data);
  });
  
  return li;
}

function renderMonsterItem(id, data) {
  const li = document.createElement('li');
  li.innerHTML = `
    <span>${data.Nome || id}</span>
    <div class="btn-group">
      <button class="btn edit-btn btn-sm">Editar</button>
      <button class="btn del-btn btn-sm">Excluir</button>
    </div>
  `;
  
  li.querySelector('.del-btn').addEventListener('click', () => {
    if (confirm(`Excluir o monstro "${data.Nome || id}"?`)) {
      deleteDocument('monsters', id);
    }
  });
  
  return li;
}

function renderItemItem(id, data) {
  const li = document.createElement('li');
  li.innerHTML = `
    <span>${data.Nome || id} (${getItemTypeName(data.Tipo)})</span>
    <div class="btn-group">
      <button class="btn edit-btn btn-sm">Editar</button>
      <button class="btn del-btn btn-sm">Excluir</button>
    </div>
  `;
  
  li.querySelector('.del-btn').addEventListener('click', () => {
    if (confirm(`Excluir o item "${data.Nome || id}"?`)) {
      deleteDocument('items', id);
    }
  });
  
  return li;
}

function renderSpellItem(id, data) {
  const li = document.createElement('li');
  li.innerHTML = `
    <span>${data.Nome || id}</span>
    <div class="btn-group">
      <button class="btn edit-btn btn-sm">Editar</button>
      <button class="btn del-btn btn-sm">Excluir</button>
    </div>
  `;
  
  li.querySelector('.del-btn').addEventListener('click', () => {
    if (confirm(`Excluir o feiti√ßo "${data.Nome || id}"?`)) {
      deleteDocument('spells', id);
    }
  });
  
  return li;
}

function renderSkillItem(id, data) {
  const li = document.createElement('li');
  li.innerHTML = `
    <div>
      <strong>${data.Nome || id}</strong>
      <div>${data.Descri√ß√£o || 'Sem descri√ß√£o'}</div>
    </div>
    <div class="btn-group">
      <button class="btn del-btn btn-sm">Excluir</button>
    </div>
  `;
  
  li.querySelector('.del-btn').addEventListener('click', () => {
    if (confirm(`Excluir a per√≠cia "${data.Nome || id}"?`)) {
      deleteDocument('skills', id);
    }
  });
  
  return li;
}

// Atualizar selects de campanhas
async function updateCampaignSelects() {
  const campaignSelects = document.querySelectorAll('select[name="field-value"]');
  const campaigns = await getDocs(collection(db, 'campaigns'));
  
  campaignSelects.forEach(select => {
    // Limpar op√ß√µes exceto a primeira
    while (select.options.length > 1) {
      select.remove(1);
    }
    
    // Adicionar campanhas
    campaigns.forEach(doc => {
      const option = document.createElement('option');
      option.value = doc.id;
      option.textContent = doc.data().Nome || doc.id;
      select.appendChild(option);
    });
  });
}

// Atualizar cards de personagens
function updateCharacterCards(snapshot) {
  const cardsContainer = document.getElementById('character-cards');
  if (!cardsContainer) return;
  
  cardsContainer.innerHTML = '';
  
  snapshot.forEach((doc) => {
    const data = doc.data();
    const card = document.createElement('div');
    card.className = 'character-card';
    card.innerHTML = `
      <h3>${data.Nome || doc.id}</h3>
      <div class="card-content">
        <p><strong>N√≠vel:</strong> ${data.N√≠vel || '1'}</p>
        <p><strong>Classe:</strong> ${data.Classe || 'Nenhuma'}</p>
        <p><strong>Campanha:</strong> ${data.Campanha || 'Nenhuma'}</p>
        <p><strong>PV:</strong> ${data.PV || '0'}</p>
        <p><strong>PE:</strong> ${data.PE || '0'}</p>
      </div>
      <div class="card-actions">
        <button class="btn view-btn btn-sm">Ver Ficha</button>
        <button class="btn assign-btn btn-sm">Atribuir</button>
        <button class="btn edit-btn btn-sm">Editar</button>
      </div>
    `;
    
    // Adicionar event listeners
    card.querySelector('.view-btn').addEventListener('click', () => {
      window.open(`ficha_personagem.html?id=${doc.id}`, '_blank');
    });
    
    card.querySelector('.assign-btn').addEventListener('click', () => {
      openAssignModal(doc.id, data.Nome || doc.id);
    });
    
    card.querySelector('.edit-btn').addEventListener('click', () => {
      openEditModal(doc.id, data);
    });
    
    cardsContainer.appendChild(card);
  });
}

// Auxiliares
function getItemTypeName(type) {
  const types = {
    'item': 'Item Comum',
    'tool': 'Ferramenta',
    'magic': 'Habilidade M√°gica'
  };
  
  return types[type] || 'Desconhecido';
}

// Sistema de Modais
function openAssignModal(characterId, characterName) {
  currentCharacterId = characterId;
  document.getElementById('character-name-modal').textContent = characterName;
  document.getElementById('assign-modal').style.display = 'block';
  
  // Carregar itens e feiti√ßos dispon√≠veis
  loadAvailableItems();
  loadAvailableSpells();
}

function openEditModal(characterId, characterData) {
  currentEditCharacterId = characterId;
  document.getElementById('edit-character-name').textContent = characterData.Nome || characterId;
  document.getElementById('edit-character-modal').style.display = 'block';
  
  // Preencher formul√°rio de edi√ß√£o
  populateEditForm(characterData);
}

// Carregar itens dispon√≠veis
async function loadAvailableItems() {
  const availableItemsDiv = document.getElementById('available-items');
  availableItemsDiv.innerHTML = '';
  
  const items = await getDocs(collection(db, 'items'));
  
  items.forEach(doc => {
    const itemData = doc.data();
    if (itemData.Tipo === 'item' || !itemData.Tipo) {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'assign-item';
      itemDiv.innerHTML = `
        <input type="checkbox" id="item-${doc.id}" value="${doc.id}">
        <label for="item-${doc.id}">${itemData.Nome || doc.id}</label>
      `;
      
      itemDiv.querySelector('input').addEventListener('change', (e) => {
        if (e.target.checked) {
          selectedItems.push(doc.id);
        } else {
          selectedItems = selectedItems.filter(id => id !== doc.id);
        }
      });
      
      availableItemsDiv.appendChild(itemDiv);
    }
  });
}

// Carregar feiti√ßos dispon√≠veis
async function loadAvailableSpells() {
  const availableSpellsDiv = document.getElementById('available-spells');
  availableSpellsDiv.innerHTML = '';
  
  const spells = await getDocs(collection(db, 'spells'));
  
  spells.forEach(doc => {
    const spellData = doc.data();
    const spellDiv = document.createElement('div');
    spellDiv.className = 'assign-item';
    spellDiv.innerHTML = `
      <input type="checkbox" id="spell-${doc.id}" value="${doc.id}">
      <label for="spell-${doc.id}">${spellData.Nome || doc.id}</label>
      `;
      
      spellDiv.querySelector('input').addEventListener('change', (e) => {
        if (e.target.checked) {
          selectedSpells.push(doc.id);
        } else {
          selectedSpells = selectedSpells.filter(id => id !== doc.id);
        }
      });
      
      availableSpellsDiv.appendChild(spellDiv);
    });
  }

  // Preencher formul√°rio de edi√ß√£o
  function populateEditForm(characterData) {
    const form = document.getElementById('edit-character-form');
    form.innerHTML = '';
    
    for (const [key, value] of Object.entries(characterData)) {
      // Pular arrays (itens, feiti√ßos, etc.)
      if (Array.isArray(value)) continue;
      
      const fieldPair = document.createElement('div');
      fieldPair.className = 'field-pair';
      
      fieldPair.innerHTML = `
        <input type="text" name="field-name" class="name-field" value="${key}" readonly>
        <input type="text" name="field-value" value="${value || ''}">
      `;
      
      form.appendChild(fieldPair);
    }
    
    // Bot√£o para adicionar novos campos
    const addButton = document.createElement('button');
    addButton.type = 'button';
    addButton.className = 'add-field-btn';
    addButton.textContent = '+ Adicionar campo';
    addButton.addEventListener('click', () => {
      addDynamicField('edit-character-form');
    });
    
    form.appendChild(addButton);
  }

  // Confirmar edi√ß√£o de personagem
  document.getElementById('confirm-edit').addEventListener('click', async () => {
    const data = getFormData('edit-character-form');
    await updateDocument('characters', currentEditCharacterId, data);
    document.getElementById('edit-character-modal').style.display = 'none';
  });

  // Confirmar atribui√ß√£o de itens e feiti√ßos
  document.getElementById('confirm-assign').addEventListener('click', async () => {
    if (!currentCharacterId) return;
    
    try {
      const characterRef = doc(db, 'characters', currentCharacterId);
      
      // Atualizar arrays
      const updates = {};
      if (selectedItems.length > 0) updates.itens = arrayUnion(...selectedItems);
      if (selectedSpells.length > 0) updates.feiticos = arrayUnion(...selectedSpells);
      
      if (Object.keys(updates).length > 0) {
        await updateDoc(characterRef, updates);
        alert('Itens e feiti√ßos atribu√≠dos com sucesso!');
      }
      
      document.getElementById('assign-modal').style.display = 'none';
      selectedItems = [];
      selectedSpells = [];
    } catch (error) {
      console.error('Erro ao atribuir itens/feiti√ßos:', error);
      alert('Erro ao atribuir itens/feiti√ßos: ' + error.message);
    }
  });

  // Bot√£o para criar per√≠cia
  document.getElementById('create-skill-btn').addEventListener('click', () => {
    document.getElementById('create-skill-modal').style.display = 'block';
  });

  // Inicializar sistema de filtros e busca
  function initSearchAndFilters() {
    // Busca de personagens
    const characterSearch = document.getElementById('character-search');
    if (characterSearch) {
      characterSearch.addEventListener('input', filterCharacters);
    }
    
    // Filtro de campanhas para personagens
    const campaignFilter = document.getElementById('character-campaign-filter');
    if (campaignFilter) {
      campaignFilter.addEventListener('change', filterCharacters);
    }
  }

  function filterCharacters() {
    const searchTerm = document.getElementById('character-search').value.toLowerCase();
    const campaignFilter = document.getElementById('character-campaign-filter').value;
    
    const characterCards = document.querySelectorAll('.character-card');
    const characterItems = document.querySelectorAll('#list-characters li');
    
    // Filtrar cards
    characterCards.forEach(card => {
      const characterName = card.querySelector('h3').textContent.toLowerCase();
      const characterCampaign = card.querySelector('p:nth-child(3)').textContent.replace('Campanha: ', '');
      
      const matchesSearch = characterName.includes(searchTerm);
      const matchesCampaign = !campaignFilter || characterCampaign === campaignFilter;
      
      card.style.display = (matchesSearch && matchesCampaign) ? 'block' : 'none';
    });
    
    // Filtrar itens da lista
    characterItems.forEach(item => {
      const characterName = item.querySelector('.character-info strong').textContent.toLowerCase();
      const characterCampaign = item.querySelector('.character-info div:nth-child(3)').textContent.replace('Campanha: ', '');
      
      const matchesSearch = characterName.includes(searchTerm);
      const matchesCampaign = !campaignFilter || characterCampaign === campaignFilter;
      
      item.style.display = (matchesSearch && matchesCampaign) ? 'flex' : 'none';
    });
  }

  // Inicializar quando o DOM estiver carregado
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSearchAndFilters);
  } else {
    initSearchAndFilters();
  }
</script>
</body>
</html>
